{"version":3,"sources":["webpack:///./src/views/todo/todo-record.vue?ce01","webpack:///./src/views/todo/todo-record.vue?e11c","webpack:///./src/views/todo/todo-record.vue","webpack:///./src/utils/indexdb.ts"],"names":["_hoisted_1","class","_defineComponent","__name","setup","__props","tableData","ref","database","Database","connect","then","res","hasObjectStoreNames","request","db","transaction","objectStore","getAll","onsuccess","value","result","_ctx","_cache","_component_el_table_column","_resolveComponent","_component_el_table","_openBlock","_createElementBlock","_createVNode","data","_unref","default","_withCtx","type","label","align","width","prop","_","__exports__","constructor","dbName","version","Promise","resolve","reject","this","window","indexedDB","open","e","success","onerror","error","onupgradeneeded","target","upgrad","add","sql","get","call","update","put","delete","cursor","tableName","openCursor","createIndex","index","getIndex","key","name","objectStoreNames","contains","create","options","keyPath","createObjectStore","autoIncrement","forEach","item","unique","message","console","log"],"mappings":"kHAAA,W,qECGA,MACMA,EAAa,CAAEC,MAAO,gBAaAC,mCAAiB,CAC3CC,OAAQ,cACRC,MAAMC,GAER,IAAIC,EAAYC,iBAAI,IACpB,MAAMC,EAAW,IAAIC,OAUrB,OATAD,EAASE,QAAQ,WAAY,GAAGC,KAAKC,IACnC,GAAIJ,EAASK,oBAAoB,QAAS,CACxC,MAAMC,EAAUN,EAASO,GAAGC,YAAY,CAAC,SAASC,YAAY,QAAQC,SACtEJ,EAAQK,UAAY,WAClBb,EAAUc,MAAQN,EAAQO,WAKzB,CAACC,EAAUC,KAChB,MAAMC,EAA6BC,8BAAkB,mBAC/CC,EAAsBD,8BAAkB,YAE9C,OAAQE,yBAAcC,gCAAoB,UAAW5B,EAAY,CAC/D6B,yBAAaH,EAAqB,CAAEI,KAAMC,mBAAOzB,IAAc,CAC7D0B,QAASC,qBAAS,IAAM,CACtBJ,yBAAaL,EAA4B,CACvCU,KAAM,QACNC,MAAO,KACPC,MAAO,SACPC,MAAO,SAETR,yBAAaL,EAA4B,CACvCc,KAAM,OACNH,MAAO,OACPC,MAAO,WAETP,yBAAaL,EAA4B,CACvCc,KAAM,QACNH,MAAO,OACPC,MAAO,WAETP,yBAAaL,EAA4B,CACvCc,KAAM,OACNH,MAAO,OACPC,MAAO,aAGXG,EAAG,GACF,EAAG,CAAC,e,iCCxDX,MAAMC,EAA2B,IAAgB,EAAQ,CAAC,CAAC,YAAY,qBAExD,gB,yDCJf,MAAM/B,EAANgC,cAES,KAAA1B,GAAU,KACV,KAAAD,QAAe,KAEtBJ,QAAQgC,EAAgBC,EAAkB,GACxC,OAAO,IAAIC,QAAQ,CAACC,EAASC,KAC3BC,KAAKjC,QAAUkC,OAAOC,UAAUC,KAAKR,EAAQC,GAC7CI,KAAKjC,QAAQK,UAAagC,IACxBJ,KAAKhC,GAAKgC,KAAKjC,QAAQO,OACvBwB,EAAQM,GACRJ,KAAKK,QAAQD,EAAG,YAElBJ,KAAKjC,QAAQuC,QAAWF,IACtBL,EAAOK,GACPJ,KAAKO,MAAMH,EAAG,YAEhBJ,KAAKjC,QAAQyC,gBAAmBJ,IAC9BJ,KAAKhC,GAAKoC,EAAEK,OAAOnC,OACnBwB,EAAQM,GACRJ,KAAKK,QAAQ,KAAM,cAIzBK,OAAON,GACLJ,KAAKhC,GAAKoC,EAAEK,OAAOnC,OAErBqC,IAAIC,EAAavC,GACf,MAAMN,EAAUiC,KAAKhC,GAAGC,YAAY,CAAC2C,GAAM,aACxC1C,YAAY0C,GACZD,IAAItC,GACPN,EAAQK,UAAagC,IACnBJ,KAAKK,QAAQD,EAAG,WAElBrC,EAAQuC,QAAWF,IACjBJ,KAAKO,MAAMH,EAAG,WAGlBS,IAAID,EAAavC,GACf,OAAO,IAAIwB,QAAQ,CAACC,EAASC,KAC3B,MAAMhC,EAAUiC,KAAKhC,GAClBC,YAAY,CAAC2C,IACb1C,YAAY0C,GACZC,IAAIxC,GACPN,EAAQK,UAAY,KAClB0B,EAAQ/B,EAAQO,QAChB0B,KAAKK,QAAQS,KAAKd,KAAMjC,EAAQO,OAAQ,KAE1CP,EAAQuC,QAAUN,KAAKO,MAAMO,KAAKd,KAAM,OAAQ,MAGpDe,OAAOH,EAAavC,GAClB,MAAMN,EAAUiC,KAAKhC,GAClBC,YAAY,CAAC2C,GAAM,aACnB1C,YAAY0C,GACZI,IAAI3C,GACPN,EAAQK,UAAY4B,KAAKK,QAAQS,KAAKd,KAAM,SAAU,IACtDjC,EAAQuC,QAAUN,KAAKO,MAAMO,KAAKd,KAAM,SAAU,IAEpDiB,OAAOL,EAAavC,GAClB,MAAMN,EAAUiC,KAAKhC,GAClBC,YAAY,CAAC2C,GAAM,aACnB1C,YAAY0C,GACZK,OAAO5C,GACVN,EAAQK,UAAY4B,KAAKK,QAAQS,KAAKd,KAAM,SAAU,IACtDjC,EAAQuC,QAAUN,KAAKO,MAAMO,KAAKd,KAAM,SAAU,IAEpDkB,OAAOC,GACL,OAAO,IAAItB,QAAQ,CAACC,EAASC,KAC3B,GAAIC,KAAKlC,oBAAoBqD,GAAY,CACvC,MAAMpD,EAAUiC,KAAKhC,GAClBC,YAAY,CAACkD,IACbjD,YAAYiD,GACZC,aACHrD,EAAQK,UAAagC,IACnBN,EAAQM,EAAEK,OAAOnC,QACjB0B,KAAKK,QAAQD,EAAG,YAElBrC,EAAQuC,QAAWF,IACjBL,EAAOK,GACPJ,KAAKO,MAAMH,EAAG,iBAGhBL,EAAO,UAIbsB,YAAYT,EAAavC,GACvB2B,KAAKhC,GACFC,YAAY,CAAC2C,GAAM,YACnB1C,YAAY0C,GACZU,MAAMjD,GAEXkD,SAASX,EAAaY,EAAUnD,GAC9B,OAAO,IAAIwB,QAAQ,CAACC,EAASC,KAC3B,MAAMhC,EAAUiC,KAAKhC,GAClBC,YAAY,CAAC2C,GAAM,YACnB1C,YAAY0C,GACZU,MAAME,GACNX,IAAIxC,GACPN,EAAQK,UAAagC,IACnB,MAAM9B,EAAS8B,EAAEK,OAAOnC,OACpBA,EACAwB,EAAQxB,GAERyB,EAAOK,IAGbrC,EAAQuC,QAAWF,IACjBL,EAAOK,GACPJ,KAAKO,MAAMO,KAAKd,KAAM,SAAU,OAKtClC,oBAAoB2D,GAClB,OAAIzB,KAAKhC,GAAG0D,iBAAiBC,SAASF,IACpCzB,KAAKK,QAAQ,KAASoB,EAAH,UACZ,IAEPzB,KAAKO,MAAM,KAASkB,EAAH,UACV,GAIXG,OAAOH,EAAc1C,EAAsB8C,GACzC,IAAK7B,KAAKhC,GAAG0D,iBAAiBC,SAASF,GAAO,CAC5C,IAAIvD,EAAmB,KAErBA,EADE2D,EAAQC,QACI9B,KAAKhC,GAAG+D,kBAAkBN,EAAM,CAAEK,QAASD,EAAQC,UAEnD9B,KAAKhC,GAAG+D,kBAAkBN,EAAM,CAAEO,eAAe,IAEjEjD,EAAKkD,QAASC,IACZ,MAAMT,EAAeS,EAAKT,KACpBU,EAAkBD,EAAKC,OAC7BjE,EAAYmD,YAAYI,EAAMA,EAAM,CAAEU,cAK5C9B,QAAQD,EAAsBgC,GAC5BC,QAAQC,IAAIlC,EAAGgC,GAAW,WAE5B7B,MAAMH,EAAsBgC,GAC1BC,QAAQC,IAAIlC,EAAGgC,GAAW,UAIf1E","file":"js/chunk-4b595a86.6865fe3b.js","sourcesContent":["export * from \"-!../../../node_modules/.pnpm/registry.npmmirror.com+mini-css-extract-plugin@0.9.0_webpack@4.46.0/node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../node_modules/.pnpm/registry.npmmirror.com+css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../node_modules/.pnpm/vue-loader@16.8.3_@vue+compiler-sfc@3.2.41_vue@3.2.41_webpack@4.46.0/node_modules/vue-loader/dist/stylePostLoader.js!../../../node_modules/.pnpm/registry.npmmirror.com+postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../node_modules/.pnpm/registry.npmmirror.com+sass-loader@10.3.1_node-sass@6.0.1_webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../node_modules/.pnpm/registry.npmmirror.com+cache-loader@4.1.0_webpack@4.46.0/node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/.pnpm/vue-loader@16.8.3_@vue+compiler-sfc@3.2.41_vue@3.2.41_webpack@4.46.0/node_modules/vue-loader/dist/index.js??ref--1-1!./todo-record.vue?vue&type=style&index=0&id=32c059d4&lang=scss&scoped=true\"","import { defineComponent as _defineComponent } from 'vue'\nimport { unref as _unref, resolveComponent as _resolveComponent, createVNode as _createVNode, withCtx as _withCtx, openBlock as _openBlock, createElementBlock as _createElementBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\"\n\nconst _withScopeId = n => (_pushScopeId(\"data-v-32c059d4\"),n=n(),_popScopeId(),n)\nconst _hoisted_1 = { class: \"todo-warpper\" }\n\nimport Database from '@/utils/indexdb';\r\nimport { reactive, ref } from 'vue';\r\n\r\ninterface ToDoItem {\r\n  id: string | number,\r\n  checked: boolean,\r\n  focus: boolean,\r\n  state: number,\r\n  todo: string\r\n}\r\n\nexport default /*#__PURE__*/_defineComponent({\n  __name: 'todo-record',\n  setup(__props) {\n\r\nlet tableData = ref([])\r\nconst database = new Database()\r\ndatabase.connect('database', 1).then(res => {\r\n  if (database.hasObjectStoreNames('todo')) {\r\n    const request = database.db.transaction(['todo']).objectStore('todo').getAll()\r\n    request.onsuccess = function () {\r\n      tableData.value = request.result\r\n    }\r\n  }\r\n})\r\n\nreturn (_ctx: any,_cache: any) => {\n  const _component_el_table_column = _resolveComponent(\"el-table-column\")!\n  const _component_el_table = _resolveComponent(\"el-table\")!\n\n  return (_openBlock(), _createElementBlock(\"section\", _hoisted_1, [\n    _createVNode(_component_el_table, { data: _unref(tableData) }, {\n      default: _withCtx(() => [\n        _createVNode(_component_el_table_column, {\n          type: \"index\",\n          label: \"序号\",\n          align: \"center\",\n          width: \"80px\"\n        }),\n        _createVNode(_component_el_table_column, {\n          prop: \"todo\",\n          label: \"代办事项\",\n          align: \"center\"\n        }),\n        _createVNode(_component_el_table_column, {\n          prop: \"state\",\n          label: \"完成状态\",\n          align: \"center\"\n        }),\n        _createVNode(_component_el_table_column, {\n          prop: \"date\",\n          label: \"完成时间\",\n          align: \"center\"\n        })\n      ]),\n      _: 1\n    }, 8, [\"data\"])\n  ]))\n}\n}\n\n})","import script from \"./todo-record.vue?vue&type=script&lang=ts&setup=true\"\nexport * from \"./todo-record.vue?vue&type=script&lang=ts&setup=true\"\n\nimport \"./todo-record.vue?vue&type=style&index=0&id=32c059d4&lang=scss&scoped=true\"\n\nimport exportComponent from \"D:\\\\workspace\\\\github.com\\\\vue-typescript\\\\node_modules\\\\.pnpm\\\\vue-loader@16.8.3_@vue+compiler-sfc@3.2.41_vue@3.2.41_webpack@4.46.0\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-32c059d4\"]])\n\nexport default __exports__","interface IObjectStore {\r\n  name: string,\r\n  unique: boolean\r\n}\r\nclass Database {\r\n\r\n  public db: any = null\r\n  public request: any = null\r\n\r\n  connect(dbName: string, version: number = 1) {\r\n    return new Promise((resolve, reject) => {\r\n      this.request = window.indexedDB.open(dbName, version)\r\n      this.request.onsuccess = (e: EventTarget) => {\r\n        this.db = this.request.result\r\n        resolve(e)\r\n        this.success(e, '数据库打开成功')\r\n      }\r\n      this.request.onerror = (e: EventTarget) => {\r\n        reject(e)\r\n        this.error(e, '数据库打开报错')\r\n      }\r\n      this.request.onupgradeneeded = (e: any) => {\r\n        this.db = e.target.result\r\n        resolve(e)\r\n        this.success(null, '数据库升级成功')\r\n      }\r\n    })\r\n  }\r\n  upgrad(e: any) {\r\n    this.db = e.target.result\r\n  }\r\n  add(sql: string, value: any) {\r\n    const request = this.db.transaction([sql], 'readwrite')\r\n      .objectStore(sql)\r\n      .add(value)\r\n    request.onsuccess = (e: any) => {\r\n      this.success(e, '数据写入成功')\r\n    }\r\n    request.onerror = (e:  any) => {\r\n      this.error(e, '数据写入失败')\r\n    }\r\n  }\r\n  get(sql: string, value: any) {\r\n    return new Promise((resolve, reject) => {\r\n      const request = this.db\r\n        .transaction([sql])\r\n        .objectStore(sql)\r\n        .get(value)\r\n      request.onsuccess = () => {\r\n        resolve(request.result)\r\n        this.success.call(this, request.result, '')\r\n      }\r\n      request.onerror = this.error.call(this, '获取失败', '')\r\n    })\r\n  }\r\n  update(sql: string, value: any) {\r\n    const request = this.db\r\n      .transaction([sql], 'readwrite')\r\n      .objectStore(sql)\r\n      .put(value)\r\n    request.onsuccess = this.success.call(this, '数据更新成功', '')\r\n    request.onerror = this.error.call(this, '数据更新失败', '')\r\n  }\r\n  delete(sql: string, value: any) {\r\n    const request = this.db\r\n      .transaction([sql], 'readwrite')\r\n      .objectStore(sql)\r\n      .delete(value)\r\n    request.onsuccess = this.success.call(this, '数据删除成功', '')\r\n    request.onerror = this.error.call(this, '数据删除失败', '')\r\n  }\r\n  cursor(tableName: any) {\r\n    return new Promise((resolve, reject) => {\r\n      if (this.hasObjectStoreNames(tableName)) {\r\n        const request = this.db\r\n          .transaction([tableName])\r\n          .objectStore(tableName)\r\n          .openCursor()\r\n        request.onsuccess = (e: any) => {\r\n          resolve(e.target.result)\r\n          this.success(e, '遍历表数据成功')\r\n        }\r\n        request.onerror = (e: any) => {\r\n          reject(e)\r\n          this.error(e, '遍历表数据失败')\r\n        }\r\n      } else {\r\n        reject('表不存在')\r\n      }\r\n    })\r\n  }\r\n  createIndex(sql: string, value: any) {\r\n    this.db\r\n      .transaction([sql], 'readonly')\r\n      .objectStore(sql)\r\n      .index(value)\r\n  }\r\n  getIndex(sql: string, key: any, value: any) {\r\n    return new Promise((resolve, reject) => {\r\n      const request = this.db\r\n        .transaction([sql], 'readonly')\r\n        .objectStore(sql)\r\n        .index(key)\r\n        .get(value)\r\n      request.onsuccess = (e: any) => {\r\n        const result = e.target.result\r\n        if (result) {\r\n            resolve(result)\r\n        } else {\r\n            reject(e)\r\n        }\r\n      }\r\n      request.onerror = (e: any) => {\r\n        reject(e)\r\n        this.error.call(this, '获取索引失败', '')\r\n      }\r\n    })\r\n  }\r\n\r\n  hasObjectStoreNames(name: string) {\r\n    if (this.db.objectStoreNames.contains(name)) {\r\n      this.success(null, `${name} 表已存在`)\r\n      return true\r\n    } else {\r\n      this.error(null, `${name} 表不存在`)\r\n      return false\r\n    }\r\n  }\r\n\r\n  create(name: string, data: IObjectStore[], options: any) {\r\n    if (!this.db.objectStoreNames.contains(name)) {\r\n      let objectStore: any = null\r\n      if (options.keyPath) {\r\n        objectStore = this.db.createObjectStore(name, { keyPath: options.keyPath })\r\n      } else {\r\n        objectStore = this.db.createObjectStore(name, { autoIncrement: true })\r\n      }\r\n      data.forEach((item) => {\r\n        const name: string = item.name\r\n        const unique: boolean = item.unique\r\n        objectStore.createIndex(name, name, { unique })\r\n      })\r\n    }\r\n  }\r\n\r\n  success(e: EventTarget | any, message: string) {\r\n    console.log(e, message || 'success')\r\n  }\r\n  error(e: EventTarget | any, message: string) {\r\n    console.log(e, message || 'error')\r\n  }\r\n}\r\n\r\nexport default Database"],"sourceRoot":""}